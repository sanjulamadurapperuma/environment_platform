openapi: 3.0.0
info:
  version: 1.0.0
  title: Environment Platform
  description: This is the RESTfull API specification for the environment platform which is developed for the environment ministry

paths:
  /applications:
    get:
      description: Return all the applications related to a user or the appointed ministry using the authentication token and admin or ministry can query the application by user-id or ministry-id and user can query the application using draft.
      parameters:
        - in: query
          name: user-id
          description: Used to query application related to a specific user(privileges for access are set to ministries and adminstrators only).
          required: false
          schema:
            type: string
        - in: query
          name: ministry-id
          description: Used to query applications appointed to a specific ministry(privileges for access are set to administrators only).
          required: false
          schema:
            type: string
        - in: query
          name: draft
          description: The user can get drafts using this parameter
          required: false
          schema:
            type: boolean
      responses:
        "200":
          description: Successful response(Success)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TreeRemovalData"
        "401":
          description: Authorization failure(Unauthorized)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "404":
          description: Request not found(Not Found)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "500":
          description: Server error(Internal Server Error)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
    post:
      description: User can submit an application or save applicationusing the state field in the body.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TreeRemovalForm"
      responses:
        "201":
          description: Created application(Created)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "401":
          description: Authorization failure(Unauthorized)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "404":
          description: Request not found(Not Found)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "406":
          description: Failure in form data verification(Not Accepteble)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error_type:
                    type: string
        "500":
          description: Server error(Internal Server Error)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
  /applications/{application-id}:
    get:
      description: Returns the information of a latest version of a specific application or a draft.
      parameters:
        - name: application-id
          in: path
          required: true
          schema:
            type: string
        - name: draft
          in: query
          description: The user can get drafts using this parameter
          required: false
          schema:
            type: boolean
        - name: user-id
          in: query
          description: The user-id is used to query the applications related to the user and the privilage is only assigned to ministries and admin.
          required: false
          schema:
            type: string
        - name: ministry-id
          in: query
          description: The ministry-id is used to query the applications appointed to the ministry and privilage is only assigned to admin.
          required: false
          schema:
            type: string
      responses:
        "200":
          description: Successful response(Success)
          content:
            application/json:
              schema:
                anyOf:
                  - $ref: "#/components/schemas/TreeRemovalObject"
                  - $ref: "#/components/schemas/TreeRemovalDraft"
        "401":
          description: Authorization failure(Unauthorized)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "404":
          description: Request not found(Not Found)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "500":
          description: Server error(Internal Server Error)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
    put:
      description: Update the information in a draft
      parameters:
        - name: application-id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TreeRemovalDraft"
      responses:
        "200":
          description: Successful response(Success)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "401":
          description: Authorization failure(Unauthorized)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "404":
          description: Requested draft not found(Not Found)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "500":
          description: Server error(Internal Server Error)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
    delete:
      description: Delete an application draft
      parameters:
        - name: application-id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Successful response(Success)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "401":
          description: Authorization failure(Unauthorized)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "404":
          description: Request draft not found(Not Found)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "500":
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
    patch:
      description: Update the existing information of the request, assign a ministry or add a new field
      parameters:
        - name: application-id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              anyOf:
                - $ref: "#/components/schemas/AssignMinistry"
                - $ref: "#/components/schemas/Progress"
                - $ref: "#/components/schemas/Field"
      responses:
        "200":
          description: Successful response(Success)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "401":
          description: Authorization failure(Unauthorized)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "404":
          description: Request not found(Not Found)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "500":
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
  /application/{application-id}/versions:
    get:
      description: This will return all the version information of a particular application
      parameters:
        - in: query
          name: user-id
          description: The user-id is used to query the applications related to the user and the privilage is only assigned to ministries and admin.
          required: false
          schema:
            type: string
        - in: query
          name: ministry-id
          description: The ministry-id is used to query the applications appointed to the ministry and privilage is only assigned to admin.
          required: false
          schema:
            type: string
        - name: application-id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Successful response(Success)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TreeRemovalObjectWithVersions"
        "401":
          description: Authorization failure(Unauthorized)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "404":
          description: Request not found(Not Found)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "500":
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
    post:
      description: This will update the exsisting tree removal application and create a new version of the application
      parameters:
        - name: application-id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TreeInformationForVersioning"
      responses:
        "201":
          description: Created application(Created)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "401":
          description: Authorization failure(Unauthorized)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "404":
          description: Request not found(Not Found)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "406":
          description: Failure in form data verification(Not Accepteble)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error_type:
                    type: string
        "500":
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
  /application/{application-id}/versions/{version-id}:
    get:
      description: This will return a spesific version of the application
      parameters:
        - name: application-id
          in: path
          required: true
          schema:
            type: string
        - name: version-id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Successful response(Success)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TreeRemovalObject"
        "401":
          description: Authorization failure(Unauthorized)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "404":
          description: Request not found(Not Found)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "500":
          description: Server error(Internal Server Error)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
  /validate:
    post:
      description: Validates the map and its coordinates
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Location"
      responses:
        "200":
          description: Validated the map object
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "401":
          description: Authorization failure(Unauthorized)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "406":
          description: Failure in validating the map(Not accepteble)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "500":
          description: Server error(Internal Server Error)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
  /applications/{application-id}/comments:
    get:
      description: Get all the conversations which has taken place in applications
      parameters:
        - name: application-id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Successful response(Success)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Conversations"
        "401":
          description: Authorization failure(Unauthorized)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "500":
          description: Server error(Internal Server Error)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
    post:
      description: Amend a new message on the conversation
      parameters:
        - name: application-id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Message"
      responses:
        "201":
          description: Created message(Created)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "401":
          description: Authorization failure(Unauthorized)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "404":
          description: Conversation not found(Not Found)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "500":
          description: Server error(Internal Server Error)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
  /applications/{application-id}/comments/{comment-id}:
    get:
      description: Get the conversation linked to the specific application
      parameters:
        - name: application-id
          in: path
          required: true
          schema:
            type: string
        - name: comment-id
          in: path
          required: true
          schema:
            type: string
        - name: user-id
          in: query
          required: true
          schema:
            type: string
        - name: ministry-id
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Successful response(Success)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SpecificConversation"
        "401":
          description: Authorization failure(Unauthorized)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "404":
          description: Conversation not found(Not Found)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string
        "500":
          description: Server error(Internal Server Error)
          content:
            application/json:
              schema:
                type: object
                properties:
                  reason:
                    type: string

components:
  schemas:
    TreeRemovalData:
      type: array
      items:
        type: object
        properties:
          application-id:
            type: string
          title:
            type: string
            description: The title of the request
          reason:
            type: string
            description: Reason to remove the tree
          applicationCreatedDate:
            $ref: "#/components/schemas/Date"
          status:
            $ref: "#/components/schemas/Progress"
          isFlagged:
            type: boolean
            description: The application is flagged by the user. (The user might be admin, ministry or user)
    TreeRemovalForm:
      type: object
      properties:
        status:
          type: string
          enum: ["save", "submit"]
        title:
          type: string
          description: The title of the request
        applicationCreatedDate:
          $ref: "#/components/schemas/Date"
        removalDate:
          $ref: "#/components/schemas/Date"
          description: Removal date of the trees
        reason:
          type: string
        type:
          type: string
        requestedBy:
          type: string
          description: The person who is requesting
        permitRequired:
          type: boolean
        landOwner:
          type: string
          description: Name of the landowner
        treeRemovalAutrhority:
          type: string
        city:
          type: string
        district:
          type: string
        nameOfTheLand:
          type: string
        planNumber:
          type: string
        location:
          $ref: "#/components/schemas/Location"
        treeInformation:
          type: array
          description: This includes all the inforemation about the trees which are to be cut
          items:
            $ref: "#/components/schemas/TreeInformation"
    TreeRemovalObject:
      type: object
      properties:
        numberOfVersions:
          type: integer
          description: This indicates number of versions having for particular application
        versionNumber:
          type: integer
        applicationId:
          type: string
        title:
          type: string
          description: The title of the title
        applicationCreatedDate:
          $ref: "#/components/schemas/Date"
        removalDate:
          $ref: "#/components/schemas/Date"
        reason:
          type: string
        type:
          type: string
        requestedBy:
          type: string
          description: Name of Requester
        permitRequired:
          type: boolean
        landOwner:
          type: string
          description: Name of the landowner
        treeRemovalAutrhority:
          type: string
        city:
          type: string
        district:
          type: string
        nameOfTheLand:
          type: string
        planNumber:
          type: string
        location:
          type: array
          description: All the points in the polygon
          items:
            type: object
            properties:
              latitude:
                type: number
              longitude:
                type: number
        treeInformation:
          type: array
          description: Information of the trees to be cut off
          items:
            $ref: "#/components/schemas/TreeInformation"
        progress:
          type: array
          items:
            type: object
            properties:
              authority:
                type: string
                description: This is the respective authority
              status:
                type: string
                description: Current status of the request processed by a particular authority
        addedFields:
          type: array
          items:
            $ref: "#/components/schemas/Field"
    TreeRemovalObjectWithVersions:
      type: object
      properties:
        numberOfVersions:
          type: integer
          description: This indicates number of versions having for particular application
        applicationId:
          type: string
        title:
          type: string
          description: The title of the title
        reason:
          type: string
        versions:
          type: array
          items:
            $ref: "#/components/schemas/TreeInformationForVersioning"
        progress:
          type: array
          items:
            type: object
            properties:
              authority:
                type: string
                description: This is the respective authority
              status:
                type: string
                description: Current status of the request processed by a particular authority
        addedFields:
          type: array
          items:
            $ref: "#/components/schemas/Field"
    TreeRemovalDraft:
      type: object
      properties:
        title:
          type: string
          description: The title of the title
        removalDate:
          $ref: "#/components/schemas/Date"
        reason:
          type: string
        type:
          type: string
        requestedBy:
          type: string
          description: Name of Requester
        permitRequired:
          type: boolean
        landOwner:
          type: string
          description: Name of the landowner
        treeRemovalAutrhority:
          type: string
        city:
          type: string
        district:
          type: string
        nameOfTheLand:
          type: string
        planNumber:
          type: string
        location:
          type: array
          description: This includes all the points in the polygon
          items:
            type: object
            properties:
              latitude:
                type: number
              longitude:
                type: number
        treeInformation:
          type: array
          description: This includes all the inforemation about the trees which are to be cut
          items:
            $ref: "#/components/schemas/TreeInformation"
    Conversations:
      type: array
      items:
        type: object
        properties:
          title:
            type: string
            description: This is the request title which is being discussed
          last_message:
            type: object
            description: The last message recieved or sent
            properties:
              user:
                type: string
                description: The person who sent the message
              time:
                type: string
                description: The message sent time
              hasRead:
                type: boolean
                description: If it is recieved and whether read or not
              message:
                type: string
          completed:
            type: boolean
            description: Whether the application is end or not
    SpecificConversation:
      type: object
      properties:
        title:
          type: string
          description: The title of the request
        messages:
          type: array
          items:
            $ref: "#/components/schemas/Message"
        completed:
          type: boolean
          description: Whether the conversation has ended or not
    Message:
      type: object
      properties:
        user:
          type: string
          description: The person who sent the message
        time:
          type: string
          description: The message sent time
        hasRead:
          type: boolean
          description: If the message has been read or not
        message:
          type: string
    Location:
      type: array
      description: This includes all the points in the polygon
      items:
        type: object
        properties:
          latitude:
            type: number
          longitude:
            type: number
    Date:
      type: object
      properties:
        year:
          type: integer
        month:
          type: integer
        day:
          type: integer
        hour:
          type: integer
        minute:
          type: integer
    Progress:
      type: object
      properties:
        ministry-name:
          type: string
        progress:
          type: string
        personChanged:
          type: string
          description: The person who changes the status
        reason:
          type: string
          description: The reason field is only added if the application is cancelled.
    TreeInformation:
      type: object
      properties:
        species:
          type: string
        treeNumber:
          type: string
        heightType:
          type: string
          enum: ["Merchantable", "Top"]
        height:
          type: number
          description: Height (in m)
        girth:
          type: number
          description: The girth at the breast height and this should be in centimeters
        logDetails:
          type: array
          items:
            type: object
            properties:
              minGirth:
                type: number
                description: Minimum girth of the log
              maxGirth:
                type: number
                description: Maximum girth of the log
              height:
                type: number
                description: Length of the log
    AssignMinistry:
      type: object
      properties:
        ministryName:
          type: string
        assignedBy:
          type: string
          description: The person who assigned the ministry
        assignedTime:
          $ref: "#/components/schemas/Date"
    Field:
      type: object
      properties:
        fieldName:
          type: string
        data:
          type: string
          description: This is the data regarding the document and this may be a document
        personAdded:
          type: string
          description: Ministry id
        dateAdded:
          $ref: "#/components/schemas/Date"
    TreeInformationForVersioning:
      type: object
      properties:
        applicationCreatedDate:
          $ref: "#/components/schemas/Date"
        removalDate:
          $ref: "#/components/schemas/Date"
        type:
          type: string
        requestedBy:
          type: string
          description: Name of the requester.
        permitRequired:
          type: boolean
        landOwner:
          type: string
          description: Name of the land owner.
        treeRemovalAuthority:
          type: string
        city:
          type: string
        district:
          type: string
        nameOfTheLand:
          type: string
        planNumber:
          type: string
        location:
          type: array
          description: This includes all the points of the land in the form of a polygon.
          items:
            type: object
            properties:
              latitude:
                type: number
              longitude:
                type: number
        treeInformation:
          type: array
          description: This includes all the information about the trees which are to be cut.
          items:
            $ref: "#/components/schemas/TreeInformation"
